{% extends "base.html" %}

{% block extrahead %}
    {% load staticfiles %}
    {% load humanize %}
    {% load documentType %}

    <link rel="stylesheet" type="text/css" href="{% static 'assets/bootstrap-datepicker/css/datepicker.css' %}"/>
    <link href="{% static "assets/datatables/css/dataTables.bootstrap.min.css" %}" rel="stylesheet">
    <link href="{% static "css/select2/select2.css" %}" rel="stylesheet">
    <link href="{% static "css/standard_header.css" %}" rel="stylesheet">
    <style>
        .disabled {
            pointer-events: none;
            cursor: not-allowed;
            background-color: #eee;
        }

        .hide_column, .ui-helper-hidden-accessible {
            display: none;
        }

        select::-ms-expand {
            display: none;
        }

        .no-select {
            /*for firefox*/
            -moz-appearance: none;
            /*for chrome*/
            -webkit-appearance: none;
        }

        .modal-backdrop {
          overflow: hidden !important
        }

        .adv-table ::-webkit-scrollbar {
          -webkit-appearance: none;
        }
        .adv-table ::-webkit-scrollbar-thumb {
          background-color: rgba(0, 0, 0, 0.3);
          border-radius: 5px;
        }
        @media (min-width: 1200px) {
            .modal-xlg {
                width: 80%; 
            }
            .modal-pylg {
                width: 70%; 
            }
        }
    </style>
{% endblock %}

{% block title %}
    {% if rec_entry.id %}
        Edit AR Receipt Recurring Entry
    {% elif is_rec_entry %}
        Add AR Receipt Recurring Entry
    {% elif journal_id %}
        Edit AR Receipt Entry
    {% else %}
        Add AR Receipt Entry
    {% endif %}
{% endblock %}
{% block parent_accounting_a_active %}active{% endblock %}
{% block parent_accounting_i_active %}active{% endblock %}
{% block parent_AR_a_active %}active{% endblock %}
{% block parent_AR_i_active %}active{% endblock %}
{% block ar_receipt_active %}active{% endblock %}

{% block content %}
    <section class="panel">
        <header class="panel-heading">
            {% if rec_entry.id %}
                <strong>Edit AR Receipt Recurring Entry</strong>
            {% elif is_rec_entry %}
                <strong>Add AR Receipt Recurring Entry</strong>
            {% elif journal_id %}
                <strong>Edit AR Receipt Entry</strong>
            {% else %}
                <strong>Add AR Receipt Entry</strong>
            {% endif %}
        </header>
        <div class="panel-body">
            <form class="form-horizontal" id="form"
                    {% if rec_entry.id %}
                  action="{% url 'edit_arreceipt_recurring_entry' rec_entry.id %}"
                    {% elif is_rec_entry %}
                  action="{% url 'add_arreceipt_recurring_entry' batch_id %}"
                    {% elif journal_id == 0 %}
                  action="{% url 'add_ar_receipt' batch_id %}"
                    {% else %}
                  action="{% url 'edit_ar_receipt' journal_id %}"
                    {% endif %}
                  role="form" method="post"  onsubmit="return checkForm(this);" enctype="multipart/form-data">
                {% csrf_token %}
                <span class="messages" id="error_currency"></span>
                {% if is_rec_entry %}
                    {% include 'RE_entry_common.html' %}
                {% endif %}

                <!-- First row -->
                <div class="form-group">
                    <div class="col-xs-6 display_block">
                      <label for="batch_no" class="col-lg-12 control-label">Batch Number</label>
                      <div class="col-lg-12 display_flex full_width search_dscrp_length">
                          {% comment %} {% if not is_rec_entry %} {% endcomment %}
                            <div class="">
                                {% if prev_batch != 0 %}
                                    <button type="button" tabindex="-1" class="btn btn-white" onclick="checkInput({{prev_batch}})"><i class="fa fa-chevron-left"></i></button>
                                {% else %}
                                    <button type="button" tabindex="-1" class="btn btn-white" disabled><i class="fa fa-chevron-left"></i></button>
                                {% endif %}
                            </div>
                          {% comment %} {% endif %} {% endcomment %}
                          <div style="margin: 0 10px 0 10px">
                              <div class="center date_length">
                                {{ batch_form.batch_no }}
                              </div>
                          </div>
                          {% comment %} {% if not is_rec_entry %} {% endcomment %}
                            <div class="">
                                {% if next_batch != 0 %}
                                    <button type="button" tabindex="-1" class="btn btn-white" onclick="checkInput({{next_batch}})"><i class="fa fa-chevron-right"></i></button>
                                {% else %}
                                    <button type="button" tabindex="-1"class="btn btn-white" disabled><i class="fa fa-chevron-right"></i></button>
                                {% endif %}
                            </div>
                          {% comment %} {% endif %} {% endcomment %}
                            {% if not is_rec_entry %}
                                <div class="" style="margin: 0 10px 0 10px">
                                    <a class="btn btn-success start" href="{% url 'add_ar_receipt' '0' %}">
                                        <i class="glyphicon glyphicon-plus"></i>
                                    </a>
                                </div>
                            {% endif %}
                      </div>
                    </div>
                    <div class="col-xs-6 display_block">
                      <label for="batch_description" class="col-lg-12 control-label">Batch
                          Description</label>
                      <div class="col-lg-12 full_width">
                          <div class="dscrp_length">
                            {{ batch_form.description }}
                          </div>
                      </div>
                    </div>
                </div>

                <!-- Second row -->
                <div class="form-group">
                    <div class="col-xs-3 display_block">
                      <label for="batch_date" class="col-lg-12 control-label">Batch Date</label>
                      <div class="col-lg-12 full_width">
                          <div class="center date_length">
                            {{ batch_form.batch_date }}
                            <input type="text" name="batch_view_date" id="batch_view_date" class="sended form-control form-control-inline input-medium default-date-picker">
                          </div>
                      </div>
                    </div>
                    <div class="col-xs-3 display_block">
                      <label for="no_entries" class="col-lg-12 control-label">No.
                          of Entries</label>
                      <div class="col-lg-12">
                          <div class="center" style="width: 60px">
                            {{ batch_form.no_entries }}
                          </div>
                      </div>
                    </div>
                    <div class="col-xs-6 display_block">
                      <label for="batch_total_amount" class="col-lg-12 control-label">Total Amount</label>
                      <div class="col-lg-12 full_width">
                          <div class="amount_length">
                            {{ batch_form.batch_amount }}
                          </div>
                      </div>
                    </div>
                </div>

                <!-- Third row -->
                <div class="form-group">
                    <div class="col-xs-6 display_block">
                      <label for="id_bank" class="col-lg-12 control-label">Bank</label>
                      <div class="col-lg-12 display_flex search_dscrp_length full_width">
                        <div class="col-xs-9" style="padding-left: 0">
                            <div class="search_dscrp_length">
                              {{ form.bank }}
                            </div>
                        </div>
                        <div class="col-xs-3" style="padding-left: 0">
                            <button id="btnSearchBank" type="button" tabindex="-1" class="btn btn-info" data-toggle="modal"
                                    href="#BankListModal"><i class="fa fa-search"></i></button>
                        </div>
                      </div>
                    </div>
                    <div class="col-xs-6 display_block">
                      <label for="id_currency" class="col-lg-12 control-label">Bank Currency</label>
                      <div class="col-lg-12 full_width">
                          <div class="currency_to_middle" style="width: 80px">
                            {{ form.currency }}
                          </div>
                      </div>
                    </div>
                </div>
                <hr>

                <!-- Fourth row -->
                <div class="form-group">
                    <div class="col-xs-6 display_block">
                      <label for="id_code" class="col-lg-12 control-label">Entry Number</label>
                      <div class="col-lg-12 display_flex full_width">
                          {% comment %} {% if not is_rec_entry %} {% endcomment %}
                            <div>
                                {% if first_journal != 0 %}
                                    <button type="button" tabindex="-1" class="btn btn-white" onclick="checkInput({{first_journal}})"><i class="fa fa-step-backward"></i></button>
                                {% else %}
                                    <button type="button" tabindex="-1" class="btn btn-white" disabled><i class="fa fa-step-backward"></i></button>
                                {% endif %}
                            </div>
                            <div style="margin: 0 10px 0 10px;">
                                {% if prev_journal != 0 %}
                                    <button type="button" tabindex="-1" class="btn btn-white" onclick="checkInput({{prev_journal}})"><i class="fa fa-chevron-left"></i></button>
                                {% else %}
                                    <button type="button" tabindex="-1" class="btn btn-white" disabled><i class="fa fa-chevron-left"></i></button>
                                {% endif %}
                            </div>
                          {% comment %} {% endif %} {% endcomment %}
                          <div class="center" style="max-width: 50px; min-width: 50px">
                              {{ form.code }}
                          </div>
                          {% comment %} {% if not is_rec_entry %} {% endcomment %}
                            <div style="margin: 0 10px 0 10px;">
                                {% if next_journal != 0 %}
                                    <button type="button" tabindex="-1" class="btn btn-white" onclick="checkInput({{next_journal}})"><i class="fa fa-chevron-right"></i></button>
                                {% else %}
                                    <button type="button" tabindex="-1" class="btn btn-white" disabled><i class="fa fa-chevron-right"></i></button>
                                {% endif %}
                            </div>
                            <div>
                                {% if last_journal != 0 %}
                                    <button type="button" tabindex="-1" class="btn btn-white" onclick="checkInput({{last_journal}})"><i class="fa fa-step-forward"></i></button>
                                {% else %}
                                    <button type="button" tabindex="-1" class="btn btn-white" disabled><i class="fa fa-step-forward"></i></button>
                                {% endif %}
                            </div>
                            <button id="btnSearchEntry" type="button" class="btn btn-info" style="margin: 0 10px 0 10px" tabindex="-1"
                                    data-toggle="modal" href="#searchEntryModal"><i class="fa fa-search"></i></button>
                          {% comment %} {% endif %} {% endcomment %}
                            {% if batch_id and batch_id != '0' and not is_rec_entry %}
                                <a class="btn btn-success start sended" href="{% url 'add_ar_receipt' batch_id %}">
                                    <i class="glyphicon glyphicon-plus"></i>
                                </a>
                            {% endif %}
                      </div>
                    </div>
                    <div class="col-xs-6 display_block">
                      <label for="id_name" class="col-lg-12 control-label">Description</label>
                      <div class="col-lg-12 full_width">
                          <div class="dscrp_length">
                            {{ form.name }}
                          </div>
                      </div>
                    </div>
                </div>

                <!-- Fifth row -->
                <div class="form-group">
                    <div class="col-xs-3 display_block">
                      <label for="id_transaction_type" class="col-lg-12 control-label" style="padding-right: 0">Transaction Type<span
                              class="span-required">(*)</span></label>
                      <div class="col-lg-12 full_width">
                          <div style="width: 130px">
                            {{ form.transaction_type }}
                          </div>
                      </div>
                    </div>
                    <!-- <div class="col-lg-1 col-sm-1"> -->
                    <!-- </div> -->
                    <div class="col-xs-3 display_block">
                      <label for="id_payment_date" class="col-lg-12 control-label">Received Date</label>
                      <div class="col-lg-12 full_width">
                          <div class="center date_length">
                            {{ form.document_date }}
                            <input type="text" name="doc_date_view" id="doc_date_view" class="sended form-control form-control-inline input-medium default-date-picker">
                          </div>
                      </div>
                    </div>
                    <!-- </div>
                                    <div class="form-group"> -->
                    <div class="col-xs-3 display_block">
                      <label for="posting_date" class="col-lg-12 control-label">Posting Date</label>
                      <div class="col-lg-12 full_width">
                          <div class="center date_length">
                            {{ form.posting_date }}
                            <input type="text" name="post_date_view" id="post_date_view" class="sended form-control form-control-inline input-medium default-date-picker">
                          </div>
                      </div>
                    </div>

                    <!-- <label for="year_period" class="col-lg-2 col-md-2 control-label">Year/Period</label> -->
                    <div class="col-xs-3 display_block">
                      <label for="document_date" class="control-label col-lg-12">Period-Year</label>
                      <div class="col-lg-12 full_width">
                          <div class="center" style="width: 80px">
                            {% if rec_entry %}
                            <input type="text" class="hide" id="perd_year" name="perd_year" value="{{rec_entry.perd_year}}">
                            <input type="text" class="hide" id="perd_month" name="perd_month" value="{{rec_entry.perd_month}}">
                            <input id="year_period" class="form-control" name="year_period" value="{{rec_entry.perd_month}}-{{rec_entry.perd_year}}" required="required"
                                disabled>
                            {% else %}
                            <input type="text" class="hide" id="perd_year" name="perd_year" value="{{perd_year}}">
                            <input type="text" class="hide" id="perd_month" name="perd_month" value="{{perd_month}}">
                            <input id="year_period" class="form-control" name="year_period" value="{{perd_month}}-{{perd_year}}" required="required"
                                disabled>
                            {% endif %}
                          </div>
                          <!-- <select id="year_period" class="form-control trs-field fieldset" name="year_period" required="required"> -->
                          <!-- </select> -->
                      </div>
                    </div>
                </div>

                <!-- Sixth row -->
                <div class="form-group" id="id_customer_group">
                    <div class="col-xs-6 display_block">
                      <label for="customer" id="customer" class="col-lg-12 control-label">Customer
                          Code<span
                                  class="span-required">(*)</span></label>
                      <div class="col-lg-12 display_flex full_width search_dscrp_length">
                        <div class="col-xs-9" style="padding-left: 0">
                            {{ form.customer }}
                        </div>
                        <div class="col-xs-3" style="padding-left: 0">
                            <button id="btnSearchCustomer" type="button" tabindex="-1" class="btn btn-info" data-toggle="modal"
                                    href="#CustomerListModal"><i class="fa fa-search"></i></button>
                        </div>
                      </div>
                    </div>
                    <div class="col-xs-6 display_block">
                      <label for="customer_name" id="customer_name" class="col-lg-12 control-label">Customer
                          Name</label>
                      <div class="col-lg-12 full_width">
                          <div class="dscrp_length">
                            {{ form.customer_name }}
                          </div>
                      </div>
                    </div>
                </div>

                <!-- Seventh row -->
                <div class="form-group" id="id_account_set_group">
                    <div class="col-xs-6 display_block">
                      <label for="id_account_set" id="id_account_set_label" class="col-lg-12 control-label">Account
                          Set<span class="span-required">(*)</span></label>
                      <div class="col-xs-6 full_width display_flex search_dscrp_length">
                        <div class="col-xs-9" id="id_account_set_div" style="padding-left: 0">
                            {{ form.account_set }}
                        </div>
                        <div class="col-xs-3" style="padding-left: 0">
                            {% if status == 2 %}
                              <button id="btnSearchAccountSet"
                                    tabindex="-1" type="button"
                                    class="btn btn-info sended"
                                    data-toggle="modal"
                                    disabled="disabled"
                                    href="#AccountListModal">
                                    <i class="fa fa-search"></i>
                              </button>
                            {% else %}
                              <button id="btnSearchAccountSet"
                                    tabindex="-1" type="button"
                                    class="btn btn-info sended"
                                    data-toggle="modal"
                                    href="#AccountListModal"><i class="fa fa-search"></i>
                              </button>
                            {% endif %}
                        </div>
                      </div>
                    </div>
                    <div class="col-xs-6 display_block">
                      <label id="id_customer_currency_label" for="id_customer_currency"
                             class="col-lg-12 control-label">Customer Currency</label>
                      <div class="col-lg-12 full_width">
                          <div class="dscrp_length">
                            {{ form.customer_currency }}
                          </div>
                      </div>
                    </div>
                </div>

                <!-- Eighth row -->
                <div class="form-group">
                    <div class="col-xs-6 display_block">
                      <label for="id_payment_code" class="col-lg-12 control-label">
                      <div id="payment_code">Payment Code <span class="span-required">(*)</span></div>

                      <div id="check_type">Payment Code <span class="span-required">(*)</span></div>
                      </label>
                      <div class="col-lg-12 full_width search_dscrp_length display_flex">
                        <div class="col-xs-9" style="padding-left: 0">
                            {{ form.payment_code }}
                        </div>
                        <div class="col-xs-3" style="padding-left: 0">
                            {% if status == 2 %}
                              <button id="btnSearchPaymentCode" tabindex="-1" type="button" class="btn btn-info sended" data-toggle="modal" disabled="disabled"
                                    href="#PaymentCodeListModal"><i class="fa fa-search"></i></button>
                            {% else %}
                              <button id="btnSearchPaymentCode" tabindex="-1" type="button" class="btn btn-info sended" data-toggle="modal"
                                    href="#PaymentCodeListModal"><i class="fa fa-search"></i></button>
                            {% endif %}
                        </div>
                      </div>
                    </div>
                    <div class="col-xs-6 display_block">
                      <label id="id_payment_check_number_label" for="payment_check_number"
                             class="col-lg-12 control-label">Check/Receipt No.</label>
                      <div class="col-lg-12">
                          <div class="dscrp_length">
                            {{ form.payment_check_number }}
                          </div>
                      </div>
                    </div>
                </div>

                <!-- Nineth row -->
                <div class="form-group">
                    <div class="col-xs-6 display_block">
                      <label for="id_document_number" class="col-lg-12 control-label">Document Number</label>
                      <div class="col-lg-9 display_block">
                          <div class="search_dscrp_length">
                            {{ form.document_number|default_if_none:"" }}
                          </div>
                      </div>
                    </div>
                    <div class="col-xs-6 display_block">
                        <div id="tax_reporting_rate_div">
                            <label for="tax_exchange_rate" class="col-lg-12 control-label">Tax Reporting Exchange Rate</label>
                            <div class="col-lg-12 display_flex search_dscrp_length full_width">
                                <div class="col-xs-9" style="padding-left: 0">
                                    {{ form.tax_exchange_rate|default:"0" }}
                                </div>
                                <div class="col-xs-3" style="padding-left: 0">
                                    <button id="btnSearchTaxExchangeRate" tabindex="-1" type="button" class="btn btn-info sended" data-toggle="modal"
                                            href="#TaxExchangeRateListModal"><i class="fa fa-search"></i></button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                  <div class="col-xs-6">
                    <div class="col-lg-12 checkbox checkbox-primary" style="padding-top: 0px; margin-left: 15px;">
                        {{ form.is_manual_doc }}
                        <label for="id_is_manual_doc">
                            Add Document Manually
                        </label>
                    </div>
                  </div>
                </div>

                <!-- Tenth row -->
                <div class="form-group">
                    {% comment %} <label for="id_serial_no" class="col-lg-2 col-sm-2 control-label">Ref. Serial Number</label>
                    <div class="col-lg-3 col-sm-3">
                        <input class="form-control sended" id="id_serial_no" name="serial_no" type="text">
                    </div> {% endcomment %}

                    <div class="col-xs-6 display_block">
                      <label for="id_reference" class="col-lg-12 control-label">Reference</label>
                      <div class="col-lg-12 full_width">
                          <div class="search_dscrp_length">
                            {{ form.reference }}
                          </div>
                      </div>
                    </div>
                    <div class="" id="id_tax_group">
                        <div class="col-xs-6 display_block">
                          <label for="id_invoice_number" class="col-lg-12 control-label">Invoice Number</label>
                          <div class="col-lg-12 full_width">
                              <div class="dscrp_length">
                                {{ form.invoice_number }}
                              </div>
                          </div>
                        </div>
                    </div>
                </div>

                {% comment %} <div class="form-group" id="id_tax_group">
                    <label for="id_invoice_number" class="col-lg-2 col-sm-2 control-label">Invoice Number</label>
                    <div class="col-lg-3 col-sm-3">
                        {{ form.invoice_number }}
                    </div>
                </div> {% endcomment %}
                <hr width="100%" style="margin-left: -20px;"/>

                <div class="form-group">
                    <div class="col-lg-12" id="payment_div">
                        <div class="form-group">
                            <label for="id_payment_amount" class="col-lg-2 col-sm-2 control-label">Receipt Amount</label>
                            <div class="col-lg-2 col-sm-2">
                                {{ form.payment_amount }}
                            </div>
                            <div class="col-lg-1 col-sm-1">
                                <input class="form-control payment_currency" tabindex="-1" id="payment_currency" name="payment_currency" readonly="true" type="text">
                            </div>
                            <div id="" class="col-lg-1 col-sm-1">
                                {{ form.original_currency_id }}
                                {{ form.payment_currency_id }}
                                {{ form.orig_exch_rate }}
                                {{ form.exchange_rate }}
                                {{ form.exchange_rate_fk }}
                            </div>
                            <label for="id_original_amount" class="col-lg-2 col-sm-2 control-label">Customer Amount</label>
                            <div class="col-lg-2 col-sm-2">
                                {{ form.original_amount }}
                            </div>
                            <div class="col-lg-1 col-sm-1">
                                <input class="form-control cust_currency" tabindex="-1" id="cust_currency" name="cust_currency" readonly="true" type="text">
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-12" id="unapplied_div">
                        <div class="form-group">
                            <label for="id_receipt_unapplied" class="col-lg-2 col-sm-2 control-label">Receipt Unapplied</label>
                            <div class="col-lg-2 col-sm-2">
                                {{ form.receipt_unapplied }}
                            </div>
                            <div class="col-lg-1 col-sm-1">
                                <input class="form-control payment_currency" tabindex="-1" id="payment_currency" name="payment_currency" readonly="true" type="text">
                            </div>
                            <div id="" class="col-lg-1 col-sm-1"></div>
                            <label for="id_customer_unapplied" class="col-lg-2 col-sm-2 control-label">Customer Unapplied</label>
                            <div class="col-lg-2 col-sm-2">
                                {{ form.customer_unapplied }}
                            </div>
                            <div class="col-lg-1 col-sm-1">
                                <input class="form-control cust_currency" tabindex="-1" id="cust_currency" name="cust_currency" readonly="true" type="text">
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-12">
                        <div class="form-group">
                            <div class="col-xs-3">
                              <label class="col-lg-12 control-label full_width">&nbsp</label>
                            <button id="btnShowRateOverrideModal" type="button" class="btn btn-info" data-toggle="modal"
                                    onclick="showRateOverrideModal()">Exchange Rates</button>
                            </div>
                            <div class="col-xs-2 display_block" id="amount-div">
                                <label for="amount" class="col-lg-12 control-label">Subtotal</label>
                                <div class="col-lg-12 full_width">
                                    <div class="amount_length">
                                      {{ form.amount }}
                                    </div>
                                </div>
                                <div class="col-sm-5" style="margin-top: 5px">
                                    <input class="form-control payment_currency" tabindex="-1" 
                                        id="subtotal_currency" name="subtotal_currency" readonly="true" type="text">
                                </div>
                            </div>
                            <div class="col-xs-2 display_block" id="tax-amount-div">
                                <label for="tax_amount" class="col-lg-12 control-label">Tax Amount</label>
                                <div class="col-lg-12 full_width">
                                    <div class="amount_length">
                                      {{ form.tax_amount }}
                                    </div>
                                </div>
                                <div class="col-sm-5" style="margin-top: 5px">
                                    <input class="form-control payment_currency" tabindex="-1" 
                                        id="tax_currency" name="tax_currency" readonly="true" type="text">
                                </div>
                            </div>
                            <div class="col-xs-2 display_block" id="tax-report-amount-div">
                                <label class="col-lg-12 control-label">Tax Rep. Amount</label>
                                <div class="col-lg-12 full_width">
                                    <div class="amount_length">
                                        <input class="form-control text-right" id="id_tax_report_amount" 
                                        name="id_tax_report_amount" readonly="readonly" tabindex="-1" type="text" value="0.00">
                                    </div>
                                </div>
                                <div class="col-sm-5" style="margin-top: 5px">
                                    <input class="form-control" tabindex="-1" 
                                        id="tax_report_currency" name="tax_report_currency" readonly="true" type="text" value="SGD">
                                </div>
                            </div>
                            <div class="col-xs-3 display_block" id="total-amount-div">
                                <label for="total_amount" class="col-lg-12 control-label">Total</label>
                                <div class="col-lg-12 full_width">
                                    <div class="amount_length">
                                      {{ form.total_amount }}
                                    </div>
                                </div>
                                <div class="col-sm-4" style="margin-top: 5px">
                                    <input class="form-control payment_currency" tabindex="-1" 
                                        id="total_currency" name="total_currency" readonly="true" type="text">
                                </div>
                            </div>
                        </div>
                        <!--<div class="adv-table table-responsive"
                             style="overflow-x: scroll; overflow-y: auto; margin-bottom: 20px">
                            <table class="display table table-bordered table-striped header-fixed"
                                   id="transaction-table">
                                <thead>
                                <tr>
                                    <th id="trs-line">Document</th>
                                    <th id="trs-distribution_code">Distribution Code</th>
                                    <th id="trs-description">Description</th>
                                    <th id="trs-account_code">Account Code</th>
                                    <th id="trs-account_name">Account Name</th>
                                    <th id="trs-amount">Amount</th>
                                    <th id="trs-tax_amount">Tax Amount</th>
                                    <th id="trs-total_amount">Total Amount</th>
                                    <th id="trs-action">Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for transaction in transactions %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ transaction.distribution_code.code }}</td>
                                        <td>{{ transaction.remark }}</td>
                                        <td>{{ transaction.account.code }}</td>
                                        <td>{{ transaction.account.name }}</td>
                                        <td>{{ transaction.amount }}</td>
                                        <td>{{ transaction.tax_amount }}</td>
                                        <td>{{ transaction.total_amount }}</td>
                                        <td class="text-center">
                                            <div class="btn-group dropup">
                                                <button type="button" class="btn btn-primary btn-sm dropdown-toggle"
                                                        data-toggle="dropdown" aria-haspopup="true"
                                                        aria-expanded="false" style="min-width: 40px!important;">Action<span
                                                        class="caret" style="margin-left:15px;"></span><span
                                                        class="sr-only">Toggle Dropdown</span></button>
                                                <ul class="dropdown-menu dropdown-menu-right">
                                                    <li>
                                                        <a onclick="editOldTransactionModal({{ transaction.id }},
                        {{ forloop.counter }})">Edit</a>
                                                    </li>
                                                </ul>
                                            </div>
                                        </td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                                <tfoot>
                                <tr>
                                    <th colspan="9" style="text-align: left;">
                                        <a id="btnAddPaymentTransDialog" href="#PaymentReceipt_TransModal"
                                           data-toggle="modal" class="btn btn-white fa fa-plus"></a>
                                    </th>
                                </tr>
                                </tfoot>
                            </table>
                        </div> -->
                        {# Table Transaction Receipt#}
                        <div class="adv-table table-responsive" id="transaction_div"
                             style="overflow-x: scroll; overflow-y: auto; margin-bottom: 20px">
                            <table class="display table table-bordered table-striped header-fixed"
                                   id="transaction-table"
                                   style="width: 100%">
                                <div class="form-group">
                                    <div id="appliedAmount_error" class="messages"
                                         style="font-size: 12.5px !important; padding-left: 20px"></div>
                                </div>
                                <thead>
                                <tr>
                                    <th id="trs-doc-num">Document Number</th>
                                    <th id="trs-doc-type">Document Type</th>
                                    <th id="trs-py-num">Payment Number</th>
                                    <th id="trs-out-amount">Pending Balance</th>
                                    <th id="trs-apply-amount">Applied Amount</th>
                                    <th id="trs-discount">Discount</th>
                                    <th id="trs-adjustment">Adjustment</th>
                                    <th id="trs-net-amount">Net Balance</th>
                                    <th id="trs-doc-amount">Original Amount</th>
                                    <th id="trs-doc-date">Document Date</th>
                                    <th id="trs-due-date">Due Date</th>
                                    <th id="trs-id">Invoice ID</th>
                                    <th id="trs-is-delete">Is Delete</th>
                                    <th id="trs-action" style="width:auto">Action</th>
                                    <th id="trs-trx-adjustment">Adjustment Transactions</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for transaction in transactions %}
                                    <tr>
                                        <td>{{ transaction.related_invoice.document_number }}</td>
                                        {% comment %} <td>{{ transaction.related_invoice.get_document_type_display }}</td> {% endcomment %}
                                        <td>{{ transaction.related_invoice.document_type|return_doc_type_str }}</td>
                                        <td>{{ transaction.related_invoice.payment_number }}</td>
                                        {% if transaction.currency.is_decimal %}
                                            <td class="text-right">{{ transaction.pending_balance|floatformat:2|intcomma }}</td>
                                            <td class="text-right"><input type="text" class="appliedAmount sended text-right" style="width: 100%;"
                                                    value="{{ transaction.total_amount|floatformat:2|intcomma }}"
                                                    id="appliedAmount-{{ forloop.counter0 }}"></td>
                                            {% if transaction.related_invoice.document_type == '1' %}
                                                <td><input type="text" class="discountAmount sended text-right" style="width: 100%;"
                                                    value="{{ transaction.discount_amount|floatformat:2|intcomma }}"
                                                    id="discountAmount-{{ forloop.counter0 }}" step="0.1"></td>
                                            
                                            {% else %}
                                                <td><input type="text" class="discountAmount sended text-right" style="width: 100%;"
                                                    value="{{ transaction.discount_amount|floatformat:2|intcomma }}"
                                                    id="discountAmount-{{ forloop.counter0 }}" step="0.1" readonly></td>
                                            {% endif%}
                                            <td class="text-right">
                                                <span class="adjustment-amount">{{ transaction.adjustment_amount|floatformat:2|intcomma }}</span>
                                                <input type="hidden" class="adjustment-amount" id="adjustmentAmount-{{ forloop.counter0 }}" value="">
                                            </td>
                                            <td class="text-right">{{ transaction.outstanding_amount|floatformat:2|intcomma }}</td>
                                            <td class="text-right">{{ transaction.related_invoice.total_amount|floatformat:2|intcomma }}</td>
                                        {% else %}
                                            <td class="text-right">{{ transaction.pending_balance|floatformat:0|intcomma }}</td>
                                            <td class="text-right"><input type="text" class="appliedAmount sended text-right" style="width: 100%;"
                                                    value="{{ transaction.total_amount|floatformat:0|intcomma }}"
                                                    id="appliedAmount-{{ forloop.counter0 }}"></td>
                                            
                                                {% if transaction.related_invoice.document_type == '1' %}
                                                    <td><input type="text" class="discountAmount sended text-right" style="width: 100%;"
                                                        value="{{ transaction.discount_amount|floatformat:0|intcomma }}"
                                                        id="discountAmount-{{ forloop.counter0 }}" step="0.1"></td>
                                                {% else %}
                                                    <td><input type="text" class="discountAmount sended text-right" style="width: 100%;"
                                                        value="{{ transaction.discount_amount|floatformat:0|intcomma }}"
                                                        id="discountAmount-{{ forloop.counter0 }}" step="0.1" readonly></td>
                                                {% endif %}
                                            <td class="text-right">
                                                <span class="adjustment-amount">{{ transaction.adjustment_amount|floatformat:0|intcomma }}</span>
                                                <input type="hidden" class="adjustment-amount" id="adjustmentAmount-{{ forloop.counter0 }}" value="">
                                            </td>
                                            <td class="text-right">{{ transaction.outstanding_amount|floatformat:0|intcomma }}</td>
                                            <td class="text-right">{{ transaction.related_invoice.total_amount|floatformat:0|intcomma }}</td>
                                        {% endif %}
                                        <td>{{ transaction.related_invoice.document_date|date:"d-m-Y" }}</td>
                                        <td>{{ transaction.related_invoice.due_date|date:"d-m-Y" }}</td>
                                        <td>{{ transaction.related_invoice_id }}</td>
                                        <td>0</td>
                                        <td class="text-center">
                                            <div class="btn-group dropup">
                                                <button type="button" class="btn btn-primary btn-sm dropdown-toggle sended"
                                                        data-toggle="dropdown" aria-haspopup="true"
                                                        aria-expanded="false" style="min-width: 40px!important;">Action<span
                                                        class="caret" style="margin-left:15px;"></span><span
                                                        class="sr-only">Toggle Dropdown</span></button>
                                                <ul class="dropdown-menu dropdown-menu-right">
                                                    <li>
                                                        <a id="adjustrow{{ forloop.counter0 }}" onclick="openAdjustmentDialog({{ forloop.counter0 }})">
                                                            {% if status == 2 %}
                                                                 View
                                                            {% else  %}
                                                                Adjust
                                                            {% endif %}
                                                        </a>
                                                    </li>
                                                    {% if status != 2 %}
                                                         <li>
                                                            <a id="removerow{{ forloop.counter0 }}" onclick="openDeleteConfirmDialog({{ forloop.counter0 }})">Delete</a>
                                                        </li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                            {% comment %} <button id="btnDeleteInEdit-{{ forloop.counter0 }}" type="button"
                                                    class="btn btn-white fa fa-minus sended"
                                                    name="removerow-{{ forloop.counter0 }}" value="Delete"
                                                    onclick="openDeleteConfirmDialog({{ forloop.counter0 }})"></button>
                                            <button id="adjustrow-{{ forloop.counter0 }}" type="button"
                                                    class="btn btn-white fa fa-pencil sended btn-adjustment-transaction" value="Adjustment"></button> {% endcomment %}
                                        </td>
                                        <td>{{ transaction.adjustments }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                                <tfoot>
                                <tr>
                                    <th colspan="14" style="text-align: left;">
                                        <a id="btnAddReceiptTransDialog" href="#Receipt_TransModal"
                                           data-toggle="modal" class="btn btn-white fa fa-plus sended"></a>
                                    </th>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                        {# Table Transaction Misc Receipt #}
                        <div class="adv-table table-responsive" id="misc_transaction_div"
                             style="overflow-x: scroll; overflow-y: auto; margin-bottom: 20px;">
                            <table class="display table table-bordered table-striped header-fixed"
                                   id="misc-transaction-table">
                                <thead>
                                <tr>
                                    <th id="trs-line">Line</th>
                                    <th id="trs-distribution_code">Distribution Code</th>
                                    <th id="trs-description">Description</th>
                                    <th id="trs-account_code">Account Code</th>
                                    <th id="trs-account_name">Account Name</th>
                                    <th id="trs-amount">Amount</th>
                                    <th id="trs-tax_amount">Tax Amount</th>
                                    <th id="trs-total_amount">Total Amount</th>
                                    <th id="trs-id2">ID</th>
                                    <th id="trs-distribution_id">Distribution Id</th>
                                    <th id="trs-account_id">Account Id</th>
                                    <th id="trs-tax_included">Tax Included</th>
                                    <th id="trs-tax_transaction">Tax Only</th>
                                    <td id="trs-tax_id">Tax ID</td>
                                    <th id="trs-manual_tax_input">Manual Tax</th>
                                    <th id="trs-base_tax_amount">Base Tax Amount</th>
                                    <th id="trs-delete">Delete</th>
                                    <th id="trs-action">Action</th>
                                    <th id="trs-row_number" style="display: none;">Row Number</th>
                                </tr>
                                </thead>
                                <tbody>
                                {% for transaction in misc_transactions %}
                                    <tr>
                                        <td>{{ forloop.counter }}</td>
                                        <td>{{ transaction.distribution_code.code }}</td>
                                        <td>{{ transaction.description }}</td>
                                        <td>{{ transaction.account.code }}</td>
                                        <td>{{ transaction.account.name }}</td>
                                        {% if transaction.currency.is_decimal %}
                                            <td style="text-align: right;">{{ transaction.amount|floatformat:2|intcomma }}</td>
                                            <td style="text-align: right;">{{ transaction.tax_amount |floatformat:2|intcomma}}</td>
                                            <td style="text-align: right;">{{ transaction.total_amount|floatformat:2|intcomma }}</td>
                                        {% else %}
                                            <td style="text-align: right;">{{ transaction.amount|floatformat:0|intcomma }}</td>
                                            <td style="text-align: right;">{{ transaction.tax_amount |floatformat:0|intcomma}}</td>
                                            <td style="text-align: right;">{{ transaction.total_amount|floatformat:0|intcomma }}</td>
                                        {% endif %}
                                        <td>{{ transaction.id }}</td>
                                        <td>{{ transaction.distribution_code.id }}</td>
                                        <td>{{ transaction.account.id }}</td>
                                        <td>{{ transaction.is_tax_include|yesno:"1,0" }}</td>
                                        <td>{{ transaction.is_tax_transaction|yesno:"1,0" }}</td>
                                        <td>{{ transaction.tax_id|default:"" }}</td>
                                        <td>{{ transaction.is_manual_tax_input|yesno:'1,0' }}</td>
                                        <td>{{ transaction.base_tax_amount|floatformat:2|intcomma }}</td>
                                        <td>0</td>
                                        <td class="text-center">
                                            <div class="btn-group dropup">
                                                <button type="button" class="btn btn-primary btn-sm dropdown-toggle set_line"
                                                        data-toggle="dropdown" aria-haspopup="true"
                                                        aria-expanded="false" style="min-width: 40px!important;">Action<span
                                                        class="caret" style="margin-left:15px;"></span><span
                                                        class="sr-only">Toggle Dropdown</span></button>
                                                <ul class="dropdown-menu dropdown-menu-right">

                                                    {% if status == 2 %}
                                                        <li>
                                                            <a id="editMiscTransaction-{{ forloop.counter }}" onclick="editTransactionRowOnEditMode({{ forloop.counter }})">View</a>
                                                        </li>
                                                    {% else %}
                                                        <li>
                                                            <a id="editMiscTransaction-{{ forloop.counter }}" onclick="editTransactionRowOnEditMode({{ forloop.counter }})">Edit</a>
                                                        </li>
                                                    {% endif %}
                                                    {% if status = 1 %} {#STATUS_TYPE_DICT['Open']#}
                                                    <li>
                                                        <a id="deleteMiscTransaction-{{ forloop.counter }}" onclick="openDeleteConfirmDialog({{ forloop.counter }})">Delete</a>
                                                    </li>
                                                    {% elif rec_entry %}
                                                    <li>
                                                        <a id="deleteMiscTransaction-{{ forloop.counter }}" onclick="openDeleteConfirmDialog({{ forloop.counter }})">Adj</a>
                                                    </li>
                                                    {% endif %}
                                                </ul>
                                            </div>
                                            {% comment %} <div class="btn-group dropup sended">
                                                <div class="btn-row">
                                                    <button id="editMiscTransaction-{{ forloop.counter0 }}"
                                                            class="btn btn-white fa fa-edit" type="button"
                                                            onclick="editTransactionRowOnEditMode({{ forloop.counter0 }})">
                                                    </button>
                                                    {% if status = 1 %} {#STATUS_TYPE_DICT['Open']#}
                                                    <button id="deleteMiscTransaction-{{ forloop.counter0 }}"
                                                            class="btn btn-white fa fa-minus" type="button"
                                                            onclick="openDeleteConfirmDialog({{ forloop.counter0 }})">
                                                    </button>
                                                    {% elif rec_entry %}
                                                    <button id="deleteMiscTransaction-{{ forloop.counter0 }}"
                                                            class="btn btn-white fa fa-minus" type="button"
                                                            onclick="openDeleteConfirmDialog({{ forloop.counter0 }})">
                                                    </button>
                                                    {% endif %}
                                                </div>
                                            </div> {% endcomment %}
                                        </td>
                                        <td>{{ forloop.counter }}</td>
                                    </tr>
                                {% endfor %}
                                </tbody>
                                <tfoot>
                                <tr>
                                    <th colspan="15" style="text-align: left;">
                                      {% if status != 2 %}
                                        <a id="btnAddMiscReceiptTransDialog" onclick="showTransactionModal()"
                                        class="btn btn-white fa fa-plus sended"></a>
                                      {%  endif %}
                                    </th>
                                </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-xs-12 text-center">
                        {% if status == 1 %} {#STATUS_TYPE_DICT['Open']#}
                            <button type="button" class="btn btn-danger" id="btnDeleteJournal"
                                    data-toggle="modal" href="#delete-dialog"
                                    {% if status == 2 %}
                                        style="display: none"
                                    {% endif %}>Delete {#STATUS_TYPE_DICT['Posted']#}
                            </button>
                        {% endif %}
                        <button type="button" class="btn btn-info hidden" id="btnSend" name="btnSend">Send</button>
                        <button type="submit" class="btn btn-success" id="btnSave" name="btnSave"
                                {% if status == 2 %}
                                    style="display: none"
                                {% endif %}>Save {#STATUS_TYPE_DICT['Posted']#}
                        </button>
                        <a class="btn btn-default"
                           {% if rec_entry %}href="{% url 'recurring_batch_list' batch_type %}"
                           {% elif is_rec_entry %}href="{% url 'recurring_batch_list' batch_type %}"
                           {% elif batch_id == 0 %}href="{% url 'batch_list' batch_type %}"
                           {% else %}href="{% url 'journal_list' journal_type batch_id %}"{% endif %}>Cancel</a>
                        <button id="btnShowHistoryModal" type="button" class="btn btn-info" data-toggle="modal"
                                    onclick="showHistoryModal()">History</button>
                    </div>
                </div>
                <input type="hidden" value="" id="listTrans" name="listTrans">
                <div id="save_error" class="messages"
                                         style="font-size: 16px !important; padding-left: 50px"></div>
            </form>
        </div>
    </section>
    <div class="modal fade" id="tableAdjustmentModal" tabindex="-1" role="dialog"
    aria-labelledby="myModalLabel"
    aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                    <h4 class="modal-title">Adjustment Transactions</h4>
                </div>
                <div class="modal-body">

                    <div class="form-horizontal">
                        <div class="row" style="margin-bottom:15px;">
                            <label class="col-md-3" style="text-align: left; font-size: 15px;">Customer Number</label>
                            <div class="col-md-3">
                                <input type="text" readonly="readonly" class="form-control" id="adjustment_customer_number" value="">
                            </div>
                            <div class="col-md-6">
                                <input type="text" readonly="readonly" class="form-control" id="adjustment_customer_name" value="">
                            </div>
                        </div>

                        <div class="row" style="margin-bottom:15px;">
                            <label class="col-md-3" style="text-align: left; font-size: 15px;">Document</label>
                            <div class="col-md-3">
                                <input type="text" readonly="readonly" class="form-control" id="adjustment_document_type" value="">
                            </div>
                            <div class="col-md-3">
                                <input type="text" readonly="readonly" class="form-control" id="adjustment_document_number" value="">
                            </div>
                            <div class="col-md-1" style="text-align: left; font-size: 15px;">
                                No
                            </div>
                            <div class="col-md-2">
                                <input type="text" readonly="readonly" class="form-control" id="adjustment_document_entry_number" value="">
                            </div>
                        </div>

                        <div class="row" style="margin-bottom:15px;">
                            <label class="col-md-3" style="text-align: left; font-size: 15px;">Adjustment No.</label>
                            <div class="col-md-2">
                                <input type="text" readonly="readonly" class="form-control" id="adjustment_entry_number" value="">
                            </div>
                            <div class="col-md-2" style="text-align: left; font-size: 15px;">
                                Net Balance
                            </div>
                            <div class="col-md-3">
                                <input type="text" readonly="readonly" class="form-control" id="adjustment_net_balance" value="">
                            </div>
                            <div class="col-md-2">
                                <input type="text" readonly="readonly" class="form-control" id="adjustment_currency" value="">
                            </div>
                        </div>

                        <div class="row" style="margin-bottom:15px;">
                            <label class="col-md-3" style="text-align: left; font-size: 15px;">Reference</label>
                            <div class="col-md-9">
                                <input type="text" class="form-control" id="adjustment_reference" value="">
                            </div>
                        </div>

                        <div class="row" style="margin-bottom:15px;">
                            <label class="col-md-3" style="text-align: left; font-size: 15px;">Description</label>
                            <div class="col-md-9">
                                <input type="text" class="form-control" id="adjustment_description" value="">
                            </div>
                        </div>

                        <table id="tableAdjustmentTransaction" class="display table table-bordered table-striped table-condensed" style="margin-bottom:0; width:100%;">
                            <thead>
                                <tr>
                                    <th>&nbsp;</th>
                                    <th>Adj. Line</th>
                                    <th>Dist. Code</th>
                                    <th>G/L Account</th>
                                    <th>Acc. Description</th>
                                    <th>Reference</th>
                                    <th>Description</th>
                                    <th>Debit</th>
                                    <th>Credit</th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                            <tfoot>
                                <tr>
                                    {% if status != 2 %}
                                    <th colspan="8"><button type="button" id="btnAddAdjustmentTransaction" class="btn btn-white fa fa-plus sended"></button></th>
                                    {% endif %}
                                </tr>
                            </tfoot>
                        </table>
                    </div>

                </div>

                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                    {% if status != 2 %}
                        <button data-dismiss="modal" class="btn btn-success" type="button">Save</button>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% if journal_id or rec_entry %}
        <div aria-hidden="true" aria-labelledby="ModalDelete" role="dialog" tabindex="-1" id="delete-dialog"
             class="modal fade">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                        <h4 class="modal-title">Delete Confirm Dialog</h4>
                    </div>
                    <div class="modal-body">
                        <form role="form" action="{% url 'ar_receipt_delete' journal_id %}"
                              method="post">
                            {% csrf_token %}
                            <div class="form-group">
                                <label>Are you sure want to delete?</label>
                            </div>
                            <button type="submit" class="btn btn-success">OK</button>
                            <a class="btn btn-default" data-dismiss="modal">Cancel</a>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        {# Modal Dialog Delete Transaction Row #}
        <div aria-hidden="true" aria-labelledby="ModalDelete" role="dialog" tabindex="-1" id="delete-transactiob-dialog"
             class="modal fade">
            <div class="modal-dialog modal-sm">
                <div class="modal-content">
                    <div class="modal-header">
                        <button aria-hidden="true" data-dismiss="modal" class="close" type="button">×</button>
                        <h4 class="modal-title">Delete Confirm Dialog</h4>
                    </div>
                    <div class="modal-body">
                        {% comment %} <form id="form-delete-dialog" role="form"
                              method="post">
                            {% csrf_token %} {% endcomment %}
                            <div class="form-group">
                                <label>Are you sure want to delete?</label>
                            </div>
                            <button type="button" class="btn btn-success" data-dismiss="modal">OK</button>
                            <a class="btn btn-default" data-dismiss="modal">Cancel</a>
                        {% comment %} </form> {% endcomment %}
                    </div>
                </div>
            </div>
        </div>
    {% endif %}
    <div class="modal fade" id="BankListModal" tabindex="-1" role="dialog"
         aria-labelledby="BankListModal" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Search Bank</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group" style="margin-right: 0px!important;margin-left: 0px!important;">
                        <section>
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="panel-body"
                                         style="font-size: 12.5px !important;">
                                        <div class="adv-table">
                                            <table id="bank-table" style="width: 100% !important;"
                                                   class="display table table-bordered table-striped table-condensed">
                                                <thead>
                                                <tr>
                                                    <th>Bank Code</th>
                                                    <th>Description</th>
                                                    <th>Currency ID</th>
                                                    <th>Currency</th>
                                                    <th>Account</th>
                                                    <th></th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <div class="modal-footer">
                        <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                        <button data-dismiss="modal" class="btn btn-success" type="button" id="btnSelectBank">Select
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="CustomerListModal" tabindex="-1" role="dialog"
         aria-labelledby="CustomerListModal"
         aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Search Customer</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group" style="margin-right: 0px!important;margin-left: 0px!important;">
                        <section class="panel">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="panel-body"
                                         style="font-size: 12.5px !important;">
                                        <div class="adv-table">
                                            <table id="customer-table" style="width: 100% !important;"
                                                   class="display table table-bordered table-striped table-condensed">
                                                <thead>
                                                <tr>
                                                    <th>Customer Code</th>
                                                    <th>Customer Name</th>
                                                    <th>Tax</th>
                                                    <th>Currency</th>
                                                    <th>Payment Term</th>
                                                    <th>Payment Mode</th>
                                                    <th>Account Set</th>
                                                    <th>Account Set ID</th>
                                                    <th>Payment Code ID</th>
                                                    <th></th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <div class="modal-footer">
                        <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                        <button data-dismiss="modal" class="btn btn-success" type="button" id="btnCustomerSelect">
                            Select
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="AccountListModal" tabindex="-1" role="dialog"
         aria-labelledby="AccountListModal"
         aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Search Account</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group" style="margin-right: 0px!important;margin-left: 0px!important;">
                        <section class="panel">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="panel-body"
                                         style="font-size: 12.5px !important;">
                                        <div class="adv-table">
                                            <table id="account-table" style="width: 100% !important;"
                                                   class="display table table-bordered table-striped table-condensed">
                                                <thead>
                                                <tr>
                                                    <th id="acc-code">Account Set Code</th>
                                                    <th id="acc-name">Description</th>
                                                    <th id="acc-type">Control Account</th>
                                                    <th id="acc-balance_type">Currency Code</th>
                                                    <th id="acc-group">Revaluation Account</th>
                                                    <th id="acc-id">Id</th>
                                                    <th></th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <div class="modal-footer">
                        <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                        <button data-dismiss="modal" class="btn btn-success" type="button" id="btnAccountSelect">
                            Select
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="modal fade" id="PaymentCodeListModal" tabindex="-1" role="dialog"
         aria-labelledby="PaymentCodeListModal"
         aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Search Payment</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group" style="margin-right: 0px!important;margin-left: 0px!important;">
                        <section class="panel">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="panel-body"
                                         style="font-size: 12.5px !important;">
                                        <div class="adv-table">
                                            <table id="payment-table" style="width: 100% !important;"
                                                   class="display table table-bordered table-striped table-condensed">
                                                <thead>
                                                <tr>
                                                    <th>Payment Code</th>
                                                    <th>Description</th>
                                                    <th>Payment Type</th>
                                                    <th></th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <div class="modal-footer">
                        <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                        <button data-dismiss="modal" class="btn btn-success" type="button" id="btnPaymentSelect">
                            Select
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="Receipt_TransModal" tabindex="-1" role="dialog"
         aria-labelledby="Receipt_TransModal"
         aria-hidden="true">
        <div class="modal-dialog modal-pylg">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Document Schedule Receipt</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <div id="document_error" class="messages"
                             style="font-size: 12.5px !important;"></div>
                    </div>
                    <div class="form-group" style="margin-right: 0px!important;margin-left: 0px!important;">
                        <section class="panel">
                            <div class="row">
                                <div class="col-lg-12">
                                    <div class="panel-body"
                                         style="font-size: 12.5px !important;">
                                        <div class="adv-table">
                                            <table id="document-receipt-table" style="width: 100% !important;"
                                                   class="display table table-bordered table-striped table-condensed">
                                                <thead>
                                                <tr>
                                                    <th id="doc-num">Document Number</th>
                                                    <th id="doc-type">Document Type</th>
                                                    <th id="doc-date">Document Date</th>
                                                    <th id="doc-amount">Document Amount</th>
                                                    <th id="py-num">Payment Number</th>
                                                    <th id="py-amount">Paid Amount</th>
                                                    <th id="out-amount">Outstanding Amount</th>
                                                    <th id="due-date">Due Date</th>
                                                    <th id="invoice-id">Invoice ID</th>
                                                    <th></th>
                                                </tr>
                                                </thead>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </section>
                    </div>
                    <div class="modal-footer">
                        <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                        <button class="btn btn-success" type="button" onclick="selectDocuments()">Select</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {# Show form Misc Receipt Transaction #}
    <div class="modal fade" id="MiscReceipt_TransModal" role="dialog"
         aria-labelledby="MiscReceipt_TransModal" aria-hidden="true">
        <div class="modal-dialog modal-lg" style="width: 80%; padding-right: 10%;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Transaction</h4>
                </div>
                <div class="modal-body">
                    <section>
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="panel-body">
                                    <form id="misc_transaction_form" class="form-horizontal" role="form" method="post"
                                          enctype="multipart/form-data" onsubmit="return false">
                                        <div class="form-group">
                                            <span id="transaction_error" class="col-lg-4 col-sm-4 messages"
                                                  style="font-size: 14.5px !important;"></span>
                                        </div>
                                        {% include 'modal_navigation.html' %}
                                        <div class="form-group">
                                            <label for="id_distribution_code" class="col-lg-2 col-sm-2 control-label">Distribution
                                                Code</label>
                                            <div class="col-lg-3 col-sm-3">
                                                <select name="distribution_code" id="id_distribution_code"
                                                        class="form-control trs-field sended">
                                                    <option value="" selected="selected">Select Distribution Code
                                                    </option>
                                                    {% for distribution_code in distribution_code_list %}
                                                        <option value="{{ distribution_code.id }}"
                                                                data-gl-account="{{distribution_code.gl_account_id}}"
                                                                data-name="{{distribution_code.name}}"
                                                                data-tax_id="{{distribution_code.tax_id}}"
                                                    >{{ distribution_code.code }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-lg-1 col-sm-1">
                                                <a id="btnSearchDistribution" tabindex="-1" type="button" class="btn btn-info sended"
                                                   data-toggle="modal"
                                                   href="#tableDistributionModal">
                                                    <i class="fa fa-search"></i></a>
                                            </div>
                                            <div class="col-lg-6 col-sm-6">
                                                <input class="form-control trs-field" type="text"
                                                       name="distribution_desc"
                                                       id="distribution_desc" disabled>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label for="id_account_code" class="col-lg-2 col-sm-2 control-label">Account
                                                Code</label>
                                            <div class="col-lg-3 col-sm-3">
                                                <select name="account_code" id="id_account_code"
                                                        class="form-control trs-field sended text-right">
                                                    <option value="" selected="selected">Select Account</option>
                                                    {% for account in account_list %}
                                                        <option value="{{ account.id }}"
                                                                data-name="{{ account.name }}">{{ account.code }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-lg-1 col-sm-1">
                                                <a id="btnSearchAccount" tabindex="-1" type="button" class="btn btn-info sended"
                                                   data-toggle="modal"
                                                   href="#tableAccountModal">
                                                    <i class="fa fa-search"></i></a>
                                            </div>
                                            <div class="col-lg-6 col-sm-6">
                                                <input class="form-control trs-field" type="text" name="account_desc"
                                                       id="account_desc" disabled>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-lg-2 col-sm-2 control-label" for="id_tax">Tax</label>
                                            <div class="col-lg-5 col-sm-5">
                                                <select name="tax" id="id_tax" class="form-control trs-field sended text-right"
                                                        required="required">
                                                    {% comment %} <option value="" selected="selected">Select Tax</option> {% endcomment %}
                                                    {% for tax in tax_list %}
                                                        <option value="{{ tax.id }}"
                                                                data-rate="{{ tax.rate }}">{{ tax.name }}</option>
                                                    {% endfor %}
                                                </select>
                                            </div>
                                            <div class="col-lg-3 col-sm-3 checkbox checkbox-primary" >
                                                <input name="manual-tax" id="manual-tax" class="styled sended" type="checkbox">
                                                <label for="manual-tax">
                                                    Manual Tax Input
                                                </label>
                                            </div>
                                        </div>
                                        <div class="form-group">
                                            <label class="col-lg-2 col-sm-2 control-label" for="amount">Amount</label>
                                            <div class="col-lg-3 col-sm-3">
                                                <input class="form-control trs-field text-right sended" type="text"
                                                       name="amount" id="amount" required>
{#                                                <input type="submit" style="visibility: hidden;" id="inputButton">#}
                                            </div>
                                            <div class="col-lg-3 checkbox checkbox-primary">
                                                <input name="sample-checkbox" id="tax-checkbox" class="styled sended" type="checkbox">
                                                <label for="tax-checkbox">
                                                    Tax Included
                                                </label>
                                            </div>
                                            <div class="col-lg-3 col-sm-1 checkbox checkbox-primary">
                                                <input name="sample-checkbox" id="tax-only-checkbox" class="styled sended" type="checkbox">
                                                <label for="tax-only-checkbox">
                                                    Tax Amount Only
                                                </label>
                                            </div>
                                        </div>
                                        <div id="amount_detail" class="form-group">
                                            <div class="col-lg-12 form-group">
                                                <label class="col-lg-2 col-sm-2 control-label" for="amount">Tax Base</label>
                                                <div class="col-lg-3 col-sm-3" style="padding-right: 2px;padding-left: 20px;">
                                                    <input class="form-control trs-field text-right sended" type="text" name="base_amount"
                                                        id="base_amount" min="0" disabled>
                                                </div>
                                                <label class="col-lg-2 col-sm-2">Tax Reporting Amount</label>
                                                <div class="col-lg-3 col-sm-3">
                                                    <input class="form-control trs-field text-right sended" type="text" name="tax_report_amount"
                                                        id="tax_report_amount" min="0" disabled>
                                                </div>
                                            </div>
                                            <div class="col-lg-12 form-group">
                                                <label class="col-lg-2 col-sm-2">Tax Amount</label>
                                                <div class="col-lg-3 col-sm-3" style="padding-right: 2px;padding-left: 20px;">
                                                    <input class="form-control trs-field text-right sended" type="text" name="tax_amount"
                                                        id="tax_amount" min="0" disabled>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="form-group" style="margin-bottom: 15px;">
                                            <label class="col-lg-2 col-sm-2 control-label" for="amount">Description</label>
                                            <div class="col-lg-10 col-sm-10">
                                                <textarea class="form-control trs-field sended" name="description"
                                                            id="description"></textarea>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </section>
                    <div class="modal-footer" style="text-align: center">
                        <button data-dismiss="modal" class="btn btn-default" type="button">Cancel</button>
                        {% if status != 2 %}
                            <button class="btn btn-success sended" type="button" id="btnAddMiscTransaction"
                                    onclick="addTransaction();">
                                Save
                            </button>
                         {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {#End show form transaction#}

    {#Show table to search Distributtion#}
    <div class="modal fade" id="tableDistributionModal" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg"
             style="width: 80%; padding-left: 10%; padding-right: 10%;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title"><strong>Distribution</strong></h4>
                </div>
                <div class="modal-body" style="padding-bottom: 0px!important; padding: 0 3%;">
                    <div class="form-group"></div>
                    <section class="panel" style="margin-bottom: 0px!important;">
                        <div class="row">
                            <div class="panel-body"
                                 style="font-size: 14px!important;">
                                <div class="adv-table" id="myDialog">
                                    <table class="display table table-bordered table-striped header-fixed"
                                           id="distribution-table" style="width: 100% !important;">
                                        <thead>
                                        <tr>
                                            <th>Code</th>
                                            <th>Name</th>
                                            <th>GL Account</th>
                                            <th>Select</th>
                                        </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <div class="modal-footer" style="text-align: center">
                    <button class="btn btn-default" type="button" data-dismiss="modal">Cancel</button>
                    <button class="btn btn-success" type="button" data-dismiss="modal">Select</button>
                </div>
            </div>
        </div>
    </div>
    {#End table to search Distribution#}

    {#Show table to search Account#}
    <div class="modal fade" id="tableAccountModal" tabindex="-1" role="dialog"
         aria-labelledby="myModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-lg"
             style="width: 80%; padding-left: 10%; padding-right: 10%;">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal"
                            aria-hidden="true">&times;</button>
                    <h4 class="modal-title"><strong>Account Set</strong></h4>
                </div>
                <div class="modal-body" style="padding-bottom: 0px!important; padding: 0 3%;">
                    <div class="form-group"></div>
                    <section class="panel" style="margin-bottom: 0px!important;">
                        <div class="row">
                            <div class="panel-body"
                                 style="font-size: 14px!important;">
                                <div class="adv-table" id="myDialog">
                                    <table class="display table table-bordered table-striped header-fixed"
                                           id="account-table-trs" style="width: 100% !important;">
                                        <thead>
                                        <tr>
                                            <th>Code</th>
                                            <th>Name</th>
                                            <th>Account</th>
                                            <th>Balance</th>
                                            <th>Amount</th>
                                            <th>Account Group</th>
                                            {% comment %} <th>Company</th>
                                            <th>Active</th> {% endcomment %}
                                            <th>Select</th>
                                        </tr>
                                        </thead>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <div class="modal-footer" style="text-align: center">
                    <button class="btn btn-default" type="button" data-dismiss="modal">Cancel
                    </button>
                    <button class="btn btn-success" type="button" data-dismiss="modal">Select
                    </button>
                </div>
            </div>
        </div>
    </div>
    {#End table to search Distribution#}

    {# Show Exchage rate #}
<div class="modal fade" id="RateOverrideModal" role="dialog"
     aria-labelledby="myModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                <h4 class="modal-title"><strong>Exchange Rate Override</strong></h4>
            </div>
            <div class="modal-body" style="padding-bottom: 0px!important; padding-left: 3%;">
                <section id="bank_section" class="panel" style="margin-bottom: 10px!important; border: 1px solid #E0E0E0; border-radius: 15px;">
                    <div class="row" style="margin-left: 20%">
                        <h5 class="text-left"><strong>Bank Currency</strong></h5>
                        <div class="panel-body"
                             style="padding: 20px!important; font-size: 14px!important;">
                            <div class="form-group text-left">
                                <label id="bank_label" class="col-lg-12 col-sm-12"></label>
                                <div class="col-lg-12 col-sm-12" style="margin: 7px">
                                    <div class="col-lg-5 col-sm-5">
                                        <input class="form-control trs-field" tabindex="-1" type="text" name="bank_rate_desc"
                                                id="bank_rate_desc" value="Rate" disabled>
                                    </div>
                                    <div class="col-lg-5 col-sm-5">
                                        <input class="form-control trs-field text-right sended" tabindex="-1" type="text" name="bank_rate" id="id_bank_rate">
                                    </div>
                                </div>
                                <div class="col-lg-12 col-sm-12" style="margin: 7px">
                                    <div class="col-lg-5 col-sm-5">
                                        <input class="form-control trs-field" type="text"  value="Payment Amount" disabled>
                                    </div>
                                    <div class="col-lg-5 col-sm-5">
                                        <input class="form-control trs-field text-right" type="text" name="bank_amount"
                                                id="bank_amount" disabled>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section id="vendor_section" class="panel" style="margin-bottom: 10px!important; border: 1px solid #E0E0E0; border-radius: 15px;">
                    <div class="row" style="margin-left: 20%">
                        <h5 class="text-left"><strong>Customer Currency</strong></h5>
                        <div class="panel-body"
                             style="padding: 20px!important; font-size: 14px!important;">
                            <div class="form-group text-left">
                                <label id="vendor_label" class="col-lg-12 col-sm-12"></label>
                                <div class="col-lg-12 col-sm-12" style="margin: 7px">
                                    <div class="col-lg-5 col-sm-5">
                                        <input class="form-control trs-field" tabindex="-1" type="text" name="vendor_rate_desc"
                                                id="vendor_rate_desc" value="Rate" disabled>
                                    </div>
                                    <div class="col-lg-5 col-sm-5">
                                        <input class="form-control trs-field text-right sended" type="text" name="vendor_rate" id="id_vendor_rate">
                                    </div>
                                </div>
                                <div class="col-lg-12 col-sm-12" style="margin: 7px">
                                    <div class="col-lg-5 col-sm-5">
                                        <input class="form-control trs-field" type="text" value="Customer Amount" disabled>
                                    </div>
                                    <div class="col-lg-5 col-sm-5">
                                        <input class="form-control trs-field text-right" type="text" name="vendor_amount"
                                                id="vendor_amount" disabled>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                </section>
            </div>
            <div class="modal-footer" style="text-align: center">
                <button class="btn btn-default" tabindex="-1" type="button" data-dismiss="modal">Cancel</button>
                {% if status != 2 %}
                <button class="btn btn-success sended" type="button" id="save-trs" onclick="saveExchangeRate()">Save</button>
                {% endif %}
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="searchEntryModal" tabindex="-1" role="dialog"
     aria-labelledby="searchEntryModal" aria-hidden="true">
    <div class="modal-dialog modal-xlg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                <h4 class="modal-title">Search Entry</h4>
            </div>
            <div class="modal-body">
              <div class="adv-table table-responsive">
                  <table class="display table table-bordered table-striped table-hover"
                         id="search_entry_table" style="width: 100%">
                      <thead>
                      <tr>
                          <th>ID</th>
                          <th>Entry Number</th>
                          <th>Document Number</th>
                          <th>Check/Receipt No.</th>
                          <th>Customer</th>
                          <th>Receipt Date</th>
                          <th>Entry Description</th>
                          <th>Payer</th>
                          <th>Receipt Amount</th>
                          <th class="text-center" style="min-width:90px!important;">Options</th>
                      </tr>
                      </thead>
                  </table>
              </div>
            </div>
        </div>
    </div>
</div>
<div class="modal fade" id="paymentHystoryModal" tabindex="-1" role="dialog"
     aria-labelledby="paymentHystoryModal" aria-hidden="true">
    <div class="modal-dialog modal-xlg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                <h4 class="modal-title">Document History</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <div class="col-xs-12 full_width" style="padding-bottom: 10px">
                        <label for="customer" class="col-lg-2 control-label" style="padding-top: 7px;">Customer</label>
                        <div class="col-lg-3">
                            <input type="text" name="cust_code" id="cust_code" class="sended form-control form-control-inline" readonly>
                        </div>
                        <div class="col-lg-7">
                            <input type="text" name="cust_name" id="cust_name" class="sended form-control form-control-inline" readonly>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-xs-12 full_width" style="padding-bottom: 10px">
                        <label for="customer" class="col-lg-2 control-label" style="padding-top: 7px;">Document</label>
                        <div class="col-lg-2">
                            <input type="text" name="invoice_type" id="invoice_type" class="sended form-control form-control-inline" readonly>
                        </div>
                        <div class="col-lg-3">
                            <input type="text" name="invoice_name" id="invoice_name" class="sended form-control form-control-inline" readonly>
                        </div>
                        <label for="customer" class="col-lg-2 control-label" style="padding-top: 7px;">Document Date</label>
                        <div class="col-lg-3">
                            <input type="text" name="doc_date" id="doc_date" class="sended form-control form-control-inline" readonly>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <div class="col-xs-12 full_width" style="padding-bottom: 10px">
                        <label for="customer" class="col-lg-2 control-label" style="padding-top: 7px;">Document Total</label>
                        <div class="col-lg-2">
                            <input type="text" name="doc_total" id="doc_total" class="sended form-control form-control-inline text-right" readonly>
                        </div>
                        <label for="customer" class="col-lg-2 control-label" style="padding-top: 7px;">Current Balance</label>
                        <div class="col-lg-3">
                            <input type="text" name="balance" id="balance" class="sended form-control form-control-inline text-right" readonly>
                        </div>
                        <div class="col-lg-3">
                            <input type="text" name="currency_code" id="currency_code" class="sended form-control form-control-inline" readonly>
                        </div>
                    </div>
                </div>
              <div class="adv-table table-responsive">
                  <table class="display table table-bordered table-striped table-hover"
                         id="payment_history_table" style="width: 100%">
                      <thead>
                      <tr>
                          <th>Transaction Type</th>
                          <th>Check/Receipt No.</th>
                          <th>Posting Date</th>
                          <th>Applied Amount</th>
                          <th>Transaction Description</th>
                          <th>Ref. No.</th>
                      </tr>
                      </thead>
                  </table>
              </div>
            </div>
            <div class="modal-footer" style="text-align: center">
                <button class="btn btn-default" tabindex="-1" type="button" data-dismiss="modal">Ok</button>
            </div>
        </div>
    </div>
</div>
{#End show Exchage rate#}
<div class="modal fade" id="TaxExchangeRateListModal" tabindex="-1" role="dialog"
        aria-labelledby="ExchListModal"
        aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"
                        aria-hidden="true">&times;</button>
                <h4 class="modal-title">Search Exchange Rate</h4>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <div id="account_error" class="messages"
                            style="font-size: 12.5px !important;"></div>
                </div>
                <div class="form-group" style="margin-right: 0px!important;margin-left: 0px!important;">
                    <section class="panel">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="panel-body"
                                        style="padding: 0px!important; font-size: 12.5px !important;">
                                    <div class="adv-table">
                                        <table id="tax-exchange-table" style="width: 100% !important;"
                                                class="display table table-bordered table-striped table-condensed">
                                            <thead>
                                            <tr>
                                                <th id="exc-from">From Currency</th>
                                                <th id="exc-to">To Currency</th>
                                                <th id="exc-date">Rate Date</th>
                                                <th id="exc-rate">Rate</th>
                                                <th id="exc-id">Id</th>
                                                <th></th>
                                            </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
                <div class="modal-footer">
                    <button data-dismiss="modal" class="btn btn-default" type="button">Close</button>
                    <button class="btn btn-success" type="button" onclick="changeTaxExchangeRate()">Select</button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extrafoot %}
    {% load staticfiles %}
    <!-- Datatables -->
    <script src="{% static "assets/datatables/js/jquery.dataTables.min.js" %}"></script>
    <script src="{% static "assets/datatables/js/dataTables.bootstrap.min.js" %}"></script>
    <script type="text/javascript" src="{% static 'assets/bootstrap-datepicker/js/bootstrap-datepicker.js' %}"></script>
    <script src="{% static 'js/advanced-form-datepicker.js' %}"></script>
    <!-- jQuery autocomplete -->
    <script src="{% static "js/select2/select2.js" %}"></script>

    <script type="text/javascript">
        var url_load_customer = "{% url 'load_customer' %}";
        var url_load_currency = "{% url 'AccLoad_currency' %}";
        var url_load_bank_list = "{% url 'load_bank_list' %}";
        var url_load_customer_list = "{% url 'load_customer_list' %}";
        var url_load_account_list = "{% url 'load_account_list' %}";
        var url_load_payment_list = "{% url 'load_payment_list' '1' %}";
        var url_ReceiptDocumentsList_as_json = "{% url 'ReceiptDocumentsList_as_json' %}";
        var url_DistributionCode__asJson = "{% url 'DistributionCode__asJson' '1' %}"; /* DIS_CODE_TYPE_DICT['AR Distribution Code'] */
        var url_Account__asJson = "{% url 'Account__asJson' %}";
        var url_Load_payment_type = "{% url 'AccLoad_payment_type' %}";
        var url_Load_Invoice_transactions = "{% url 'invoice_transactions_list_as_json' %}";
        var url_load_applied_doc_history = "{% url 'load_applied_doc_history' %}";
        var journal_id = "{{journal_id}}";
        var batch_id = "{{batch_id}}";
        var url_load_account_set_list = "{% url 'AccountSetList__asJson' '1' %}"; /* ACCOUNT_SET_TYPE['AR Account Set'] */
        var current_line = 0;
        var post_date_click = '';
        var post_date_enter = '';
        var transaction_new = [];
        var batchId = "{{batch_id}}";
        var bank_is_decimal = 1;
        var vendor_is_decimal = 1;
        var tax_reporting_rate = 1;
        var has_old_rate = "{{has_old_rate}}";

        {% if status == 2 %}
        var jrn_status = '2';
        {% else %}
        var jrn_status = '';
        {% endif %}

        {% if status == 2 or status == 4 %} /* STATUS_TYPE_DICT['Posted'] or STATUS_TYPE_DICT['Reversed']*/
            $('input').attr('readonly', 'readonly');
            $(".sended").attr("disabled", "disabled");
        {% endif %}

        var doc_number;
        var doc_type;
        var doc_balance;
        var doc_total;
        var doc_date;
        $('#transaction-table').on( 'draw.dt', function () {
            $('#transaction-table tbody tr').on('click', function () {
                var table = $('#transaction-table').DataTable();
                var row = $(this).index();
                doc_number = table.cell(row, $("#trs-doc-num").index()).data();
                doc_type = table.cell(row, $("#trs-doc-type").index()).data();
                doc_balance = table.cell(row, $("#trs-net-amount").index()).data();
                doc_total = table.cell(row, $("#trs-doc-amount").index()).data();
                doc_date = table.cell(row, $("#trs-doc-date").index()).data();

                $('#transaction-table tbody tr').each(function () {
                    $(this).closest('tr').css('background-color', '#f9f9f9');
                });

                $(this).closest('tr').css('background-color', '#3ff3f3');
            });
        });

        function showHistoryModal() {
            $('#doc_total').val(doc_total);
            $('#doc_date').val(doc_date);
            $('#balance').val(doc_balance);
            $('#invoice_type').val(doc_type);
            $('#invoice_name').val(doc_number);
            $('#currency_code').val($('#id_customer_currency option:selected').text());
            $('#cust_code').val($('#id_customer option:selected').text());
            $('#cust_name').val($('#id_customer_name').val());
            var ven_id = $('#id_customer').val();

            if (doc_number && ven_id) {
                $('#payment_history_table').DataTable().destroy();
                $('#payment_history_table').dataTable({
                    bLengthChange: false,
                    searching: false,
                    paging: false,
                    info: false,
                    scrollY: '50vh',
                    scrollX: true,
                    scrollCollapse: true,
                    "serverSide": true,
                    "ajax": {
                        method: "POST",
                        "url": url_load_applied_doc_history,
                        dataType: 'JSON',
                        data: {
                            'doc': doc_number,
                            'type': 'AR',
                            'vendor': ven_id
                        },
                    },
                    "columns": [
                        {"data": "trnx_type", "sClass": "text-left", "orderable": false,},
                        {"data": "check", "sClass": "text-left", "orderable": false,},
                        {"data": "posting_date", "sClass": "text-left", "orderable": false,},
                        {"data": "apply_amount", "sClass": "text-right", "orderable": false,},
                        {"data": "trnx_desc", "sClass": "text-left", "orderable": false,},
                        {"data": "doc_number", "sClass": "text-left", "orderable": false,},
                        
                    ]
                });

                setTimeout(() => {
                    $('#payment_history_table').DataTable().columns.adjust();
                }, 300);

                $.ajax({
                    method: "POST",
                    url: url_load_applied_doc_history,
                    dataType: 'JSON',
                    data: {
                        'doc': doc_number,
                        'type': 'AR',
                        'vendor': ven_id
                    },
                    success: function (data) {
                        $('#balance').val(data.data[0].balance);
                    }
                });


                $('#paymentHystoryModal').modal('show');
            }
        }

        var is_rec_entry = "{{is_rec_entry}}";
        if('True' == is_rec_entry){
            var d = document,
                h = d.getElementsByTagName('head')[0],
                s = d.createElement('script');
            s.type = 'text/javascript';
            s.async = true;
            s.src = "/static/js/accounting/RE_entry_common.js";
            h.appendChild(s);

            schedule_list = [
                {% for schedule in schedule_list %}
                    {% if not forloop.first %}, {% endif %}
                    {
                        id: "{{ schedule.id }}",
                        code: "{{ schedule.code }}",
                        desc: "{{ schedule.description }}",
                    }
                {% endfor %}
            ]

            var rec_schedule_id = "{{rec_entry.schedule_id}}";
            if(!rec_schedule_id){
                rec_schedule_id = '{{schedule_id}}';
            }
            if (rec_schedule_id) {
                schedule_list.forEach(element => {
                    if (element.id == rec_schedule_id) {
                        $('#id_schedule_code').val(element.code);
                        $('#id_schedule_desc').val(element.desc);
                        $('#schedule_id').val(element.id);
                    }
                });
            }

            var is_expire = "{{rec_entry.is_expire}}";
            if (is_expire == 'True') {
                $('#is_expire').attr('checked', 'checked');
            }
            var is_active = "{{rec_entry.is_active}}";
            if (is_active == 'True') {
                $('#is_active').attr('checked', 'checked');
            }
            $('#batch_view_date').attr('disabled', true);
            $('#doc_date_view').attr('disabled', true);
            $('#post_date_view').attr('disabled', true);

            $('#schedule-code-table').on( 'draw.dt', function () {
                selectTableRow('#schedule-code-table', 5);
                $("input[type='radio']").each(function () {
                    $(this).closest('tr').css('background-color', '#f9f9f9');
                });
            });
        } else {
            if (has_old_rate == "1") {
                pop_ok_dialog("Warning",
                "This journal uses an old exchange rate.",
                function () {})
            }
        }
        var selected_row = [];

        $.account_list = [];
        $.dist_code_list = [];

        {% for account_row in account_list %}
        $.account_list.push({
            'id' : '{{ account_row.id }}',
            'code' : '{{ account_row.code }}',
            'name' : '{{ account_row.name }}'
        });
        {% endfor %}

        {% for dist_code in distribution_code_list %}
        $.dist_code_list.push({
            'id' : '{{ dist_code.id }}',
            'code' : '{{ dist_code.code }}',
            'name' : '{{ dist_code.name }}',
            'gl_account_id' : '{{ dist_code.gl_account_id }}'
        });
        {% endfor %}

        function checkInput(j_id){
            var id = '{{journal_id}}';
            if('True' == is_rec_entry){
                id = '{{rec_entry.id}}';
            }
            if (id == '0') {
                pop_ok_cancel_dialog(
                    "Data loss warning!",
                    "Unsaved data will be lost. Do you want to proceed?",
                    function () { 
                        if('True' == is_rec_entry){
                            window.location.href = '/accounting/edit/ARReceipt-RE/' + j_id + '/'; 
                        } else {
                            window.location.href = '/accounting/edit/ARReceipt/' + j_id + '/'; 
                        }
                    },
                    function () {
                        if('True' == is_rec_entry){
                            window.location.href = '/accounting/add/ARReceipt-RE/' + batchId + '/'; 
                        } else {
                            window.location.href = '/accounting/add/ARReceipt/' + batchId + '/'; 
                        }
                    }
                );
            } else {
                if('True' == is_rec_entry){
                    window.location.href = '/accounting/edit/ARReceipt-RE/' + j_id + '/';
                } else {
                    window.location.href = '/accounting/edit/ARReceipt/' + j_id + '/';
                }
            }

        }

        $('#start_date').on('change', function(){
            if (batchId && batchId != '0' && batchId != 'None') {
                $('#doc_date_view').val($('#start_date').val()).trigger('change');
            } else {
                $('#batch_view_date').val($('#start_date').val()).trigger('change');
            }
        })
        {% comment %} var jrn_prd = "{{journal.perd_month}}";
        var rec_prd = "{{rec_entry.perd_month}}";
        if (!jrn_prd && !rec_prd) {
            $('#perd_year').val($('#id_document_date').val().split("-")[0]);
            $('#perd_month').val($('#id_document_date').val().split("-")[1]);
            $('#year_period').val($('#id_document_date').val().split("-")[1] + "-" + $('#id_document_date').val().split("-")[0]);
        } {% endcomment %}
        

        $(document).ready(function () {
            {% if journal.id %}
                {% if journal.tax_exchange_rate == 0 %}
                    get_tax_reporting_rate('{{journal.currency_id}}', '{{journal.document_date|date:"Y-m-d"}}');
                {% else %}
                    tax_reporting_rate = parseFloat("{{journal.tax_exchange_rate}}");
                    var tax_report_amount = float_format($('#id_tax_amount').val()) * tax_reporting_rate;
                    $('#id_tax_report_amount').val(comma_format(tax_report_amount));
                {% endif %}
            {% endif %}

          if ('True' != is_rec_entry) {
            var dttbl = $('#search_entry_table').DataTable({
                "order": [[3, "asc"]],
                "serverSide": true,
                stateSave: true,
                "ajax": {
                    "url": "{% url 'JournalList__asJson' journal_type batch_id %}"
                },
                "columns": [
                    {
                        "data": "id",
                        "visible": false,
                    },
                    {"data": "code", "orderable": false, "width": "10px"},
                    {"data": "document_number", "orderable": false, "width": "180px"},
                    {"data": "check_number", "orderable": false, "width": "180px"},
                    {"data": "cust_supp_code", "orderable": false, "width": "50px"},
                    {"data": "document_date", "orderable": false, "width": "50px"},
                    {"data": "name", "orderable": false},
                    {"data": "cust_supp_name", "orderable": false},
                    {"data": "amount", "orderable": false, "sClass": "text-right"},
                    {
                        "sClass": "text-center",
                        "orderable": false,
                        "data": null,
                        "render": function (data, type, row, meta) {
                            var btn =
                                    '<div class="btn-group dropdown">' +
                                    '<button type="button"' +
                                    'class="btn btn-primary btn-sm dropdown-toggle"' +
                                    'style="min-width: 30px!important;">';
                            var btn_blank =
                                    '<div class="btn-group dropdown">' +
                                    '<button type="button"' +
                                    'class="btn btn-default btn-sm dropdown-toggle not-use"' +
                                    'data-toggle="dropdown" aria-haspopup="true"' +
                                    'aria-expanded="false"' +
                                    'style="min-width: 40px!important;">Action' +
                                    '<span class="caret" style="margin-left:15px"></span>' +
                                    '<span class="sr-only">Toggle Dropdown</span>' +
                                    '</button>' +
                                    '<ul class="dropdown-menu dropdown-menu-right">' +
                                    '<li>';
                            if ((row.status == '1') /* STATUS_TYPE_DICT['Open'] */
                                || (row.status == '2') /* STATUS_TYPE_DICT['Posted'] */
                                || (row.status == '7') /* STATUS_TYPE_DICT['Prov. Posted'] */
                                || (row.status == '8')) { /* STATUS_TYPE_DICT['Draft'] */
                                if (row.batch_type == 3) {
                                    btn += '<a href="/accounting/edit/ARReceipt/' + row.id + '/" style="text-decoration: none; color: white">View</a></button>';
                                }
                            } else {
                                btn = btn_blank;
                            }

                            btn += '</li></ul/div>';
                            return btn;
                        }
                    }
                ]
            });
          } else if ('True' == is_rec_entry && batchId != 'None' && batchId != '' && batchId != '0' ) {
            var dttbl = $('#search_entry_table').DataTable({
                "order": [[3, "asc"]],
                "serverSide": true,
                stateSave: true,
                "ajax": {
                    "url": "{% url 'rec_entries_as_Json' batch.batch_type batch.id %}"
                },
                "columns": [
                    {
                        "data": "id",
                        "visible": false,
                    },
                    {"data": "code", "orderable": false, "width": "10px"},
                    {"data": "document_number", "orderable": false, "width": "180px"},
                    {"data": "check_number", "orderable": false, "width": "180px"},
                    {"data": "cust_supp_code", "orderable": false, "width": "50px"},
                    {"data": "document_date", "orderable": false, "width": "50px"},
                    {"data": "name", "orderable": false},
                    {"data": "cust_supp_name", "orderable": false},
                    {"data": "amount", "orderable": false, "sClass": "text-right"},
                    {
                        "sClass": "text-center",
                        "orderable": false,
                        "data": null,
                        "render": function (data, type, row, meta) {
                            var btn =
                                    '<div class="btn-group dropdown">' +
                                    '<button type="button"' +
                                    'class="btn btn-primary btn-sm dropdown-toggle"' +
                                    'style="min-width: 30px!important;">';
                            if (row.batch_type == 3) {
                                btn += '<a href="/accounting/edit/ARReceipt-RE/' + row.id + '/" style="text-decoration: none; color: white">View</a></button>';
                            }
                            btn += '</li></ul/div>';
                            return btn;
                        }
                    }
                ]
            });
          } else {
            $('#btnSearchEntry').attr('disabled', 'disabled')
          }
          $('#search_entry_table').parents().eq(0).attr('style', 'overflow: scroll; max-height: 500px');

          //validateDate('#doc_date_view', '#post_date_view');

            var is_decimal = '{{is_decimal}}';
            if (is_decimal == 'True' || is_decimal == '1' || is_decimal == '') {
                is_decimal = true;
                bank_is_decimal = 1;
            } else {
                is_decimal = false;
                bank_is_decimal = 0;
            }
            var is_ven_decimal = true;
            try{
                is_ven_decimal = '{{is_ven_decimal}}';
                if (is_ven_decimal == 'True' || is_ven_decimal == '1' || is_ven_decimal == '') {
                    is_ven_decimal = true;
                    vendor_is_decimal = 1;
                } else {
                    is_ven_decimal = false;
                    vendor_is_decimal = 0;
                }
            } catch(e) {

            }

            var cust_cur = $('#id_customer_currency').val();
            cust_cur = $("#id_customer_currency option[value=" + cust_cur + "]").text();
            $('.cust_currency').val(cust_cur);

            $('#id_code').val({{entry_no}});

            $('#id_batch_date').addClass('hide');
            $('#id_document_date').addClass('hide');
            $('#id_posting_date').addClass('hide');

            $("#post_date_view").addClass("default-date-picker");
            var date_view = dateView($("#id_posting_date").val());
            $("#post_date_view").datepicker('setDate', date_view);

            $("#doc_date_view").addClass("default-date-picker");
            var date_view = dateView($("#id_document_date").val());
            $("#doc_date_view").datepicker('setDate', date_view);

            $("#batch_view_date").addClass("default-date-picker");
            var theday = dateView($("#id_batch_date").val())
            $("#batch_view_date").datepicker('setDate', theday);

            {% comment %} if($('#id_batch_no').val()) {
                $("#batch_view_date").prop('disabled', true);
            } {% endcomment %}

            if($('#id_batch_amount').val()) {
                $("#id_batch_amount").val(comma_format($('#id_batch_amount').val()));
            }

            $('#id_serial_no').attr('disabled', true);
            // FillYearPeriodOptLst();

            // $('#doc_date_view').change(function () {
            //     ResetYearPeriodOptLst();
            // });

            $("#id_transaction_type").select2({});

        $("#id_distribution_code").on('change', function () {
            name = $(this).find(':selected').data('name');
            account_code = $(this).find(':selected').data('gl-account');
            tax_id = $(this).find(':selected').data('tax_id');
            if (name && name != 'undefined') {
                $('#distribution_desc').val(name);
                $("#description").val(name);
            }
            if (account_code && account_code != 'undefined') {
                $('#id_account_code').val(account_code).trigger('change');
            }
            if (tax_id != 'None') {
                $('#id_tax').val(tax_id).trigger('change');
            } else {
                {% comment %} $('#id_tax').val(0); {% endcomment %}
            }
        });

        $("#id_account_code").on('change', function () {
            name = $(this).find(':selected').data('name');
            if (name != 'undefined') {
                $('#account_desc').val(name);
            }
        });

        if(is_decimal) {
            $('#id_amount').val(comma_format($('#id_amount').val()));
            $('#id_tax_amount').val(comma_format($('#id_tax_amount').val()));
            $('#id_total_amount').val(comma_format($('#id_total_amount').val()));
            $('#id_payment_amount').val(comma_format($('#id_payment_amount').val()));
            $('#id_receipt_unapplied').val(comma_format($('#id_receipt_unapplied').val()));
        } else {
            $('#id_amount').val(comma_format($('#id_amount').val(), 0));
            $('#id_tax_amount').val(comma_format($('#id_tax_amount').val(), 0));
            $('#id_total_amount').val(comma_format($('#id_total_amount').val(), 0));
            $('#id_payment_amount').val(comma_format($('#id_payment_amount').val(), 0));
            $('#id_receipt_unapplied').val(comma_format($('#id_receipt_unapplied').val(), 0));
        }

        if (is_ven_decimal) {
            $('#id_original_amount').val(comma_format($('#id_original_amount').val()));
            $('#id_customer_unapplied').val(comma_format($('#id_customer_unapplied').val()));
        } else {
            $('#id_original_amount').val(comma_format($('#id_original_amount').val(), 0));
            $('#id_customer_unapplied').val(comma_format($('#id_customer_unapplied').val(), 0));
        }


        $('.numbersOnly').keyup(function () {
            this.value = this.value.replace(/[^0-9\.]/g, '');
        });
        $( "#check_type" ).hide();
        $('#transaction-table').DataTable({
            "paging":  false,
            'bFilter': false,
            'bLengthChange': false,
            'bSort': false,
            'columnDefs': [
                {
                    "visible": false,
                    targets: [11],
                },
                {
                    "visible": false,
                    targets: [12],
                },
                {
                    "visible": false,
                    targets: [14],
                },
            ]
        });

        $('#misc-transaction-table').DataTable({
            "paging":  false,
            'bFilter': false,
            'ordering': false,
            'bLengthChange': false,
            'bSort': false,
            'columnDefs': [
                {
                    "width": "8%",
                    targets: [17],
                },
                {
                    "visible": false,
                    targets: [8, 9, 10, 11, 12, 13, 14, 15, 16, 18],
                },
                {
                    className: "text-right",
                    targets: [5, 6, 7],
                }
            ]
        });

        $('#id_customer').select2({
            placeholder: "Select Customer",
            allowClear: true
        });

        $('#id_payment_code').select2({
            placeholder: "Select Payment Code",
        });

        $('#id_account_set').select2({
            placeholder: "Select Account Set"
        });

        // $('#id_bank').select2({
        //     placeholder: "Select Bank",
        // });

        $('#id_tax').select2({
            placeholder: "Select Tax",
            width: '100%',
            allowClear: true,
        });

        $('#id_distribution_code').select2({
            placeholder: "Select Distribution Code",
            width: '100%',
            allowClear: true,
        });

        $('#id_account_code').select2({
            placeholder: "Select Account Code",
            width: '100%',
        });

        {% if bank_id %}
            $('#id_bank').val({{bank_id}}).trigger('change');
            $('#btnSearchBank').prop('disabled', true);
            $('#id_bank').addClass('disabled');
        {% else %}
            $('#id_bank').select2({
                placeholder: "Select Bank",
            });
        {% endif %}

        // if (parseInt(batch_id) != 0) {
        //     $('button[type="submit"]').prop('disabled', false);
        //     $('#id_bank option:not(:selected)').attr('disabled', true);
        // }

        if (journal_id != '0') {
            $('#id_transaction_type').addClass('disabled');
            //$("#id_customer").select2('destroy');
            $("#id_customer").prop('disabled', true);
            $('#btnSearchCustomer').prop('disabled', true);
            $('#id_payment_code').prop('disabled', false);
            $("#id_is_manual_doc").attr('disabled', true);
        }

        if ($("#id_transaction_type").val() == '1') {
            $('#misc_transaction_div').addClass('hidden');
            $("#id_tax_group").addClass('hidden');
            $('#amount-div').children().addClass('hidden');
            $('#tax-amount-div').children().addClass('hidden');
            $('#tax-report-amount-div').children().addClass('hidden');
            $('#total-amount-div').addClass('hidden');
            $('#payment_div').removeClass('hidden');
            $('#unapplied_div').removeClass('hidden');
            $('#tax_reporting_rate_div').addClass('hidden');

            if(!$('#id_customer').val()) {
                $('#id_account_set').prop('disabled', true);
                $('#id_payment_code').prop('disabled', true);
                $('#btnAddReceiptTransDialog').attr('disabled', 'disabled');
                $('#btnSearchAccountSet').prop('disabled', true);
                $('#btnSearchPaymentCode').prop('disabled', true);
                $('button[type="submit"]').prop('disabled', true);
            }

            $('#id_total_amount').val(comma_format(float_format($('#id_payment_amount').val()) - float_format($('#id_receipt_unapplied').val())));
        }  else if ($("#id_transaction_type").val() == '3') {
            $('#misc_transaction_div').addClass('hidden');
            $("#id_tax_group").addClass('hidden');
            $('#amount-div').children().addClass('hidden');
            $('#tax-amount-div').children().addClass('hidden');
            $('#tax-report-amount-div').children().addClass('hidden');
            $('#total-amount-div').addClass('hidden');
            $('#payment_div').removeClass('hidden');
            $('#unapplied_div').addClass('hidden');
            $('#tax_reporting_rate_div').addClass('hidden');

            $('#transaction-table').DataTable().clear().draw();
            $('#transaction-table').addClass('hidden');
            $('#transaction_div').addClass('hidden');
            $('#misc-transaction-table').DataTable().clear().draw();
            $('#misc_transaction_div').addClass('hidden');

            if(!$('#id_customer').val()) {
                $('#id_account_set').prop('disabled', true);
                $('#id_payment_code').prop('disabled', true);
                //$('#btnAddReceiptTransDialog').attr('disabled', 'disabled');
                $('#btnSearchAccountSet').prop('disabled', true);
                $('#btnSearchPaymentCode').prop('disabled', true);
                $('button[type="submit"]').prop('disabled', true);
            }
        } else {
            $('#transaction_div').addClass('hidden');
            $('#misc_transaction_div').removeClass('hidden');
            $("#id_tax_group").removeClass('hidden');
            //$('#id_customer_group').addClass('hidden');
            //$('#id_account_set_group').addClass('hidden');
            //$("#id_customer").prop('disabled', true);
            //$("#id_account_set").prop('disabled', true);
            $("#id_customer").prop('required', false);
            $("#id_account_set").prop('required', false);
            $('#payment_div').addClass('hidden');
            $('#unapplied_div').addClass('hidden');
            $('#total_amount_div').removeClass('hidden');
            $('#tax_reporting_rate_div').removeClass('hidden');

            // count line
            $('#misc-transaction-table tbody tr').each(function (indx) {
                current_line = current_line + 1;
            });
        }

        isManualDoc = $('#id_is_manual_doc:checkbox:checked').length;
        if(isManualDoc > 0) {
            //$('#id_document_number').prop('readonly', false);
            $('#id_document_amount').removeAttr('readonly');
            $('.readonly').off('keydown paste');
            $('#id_document_number').removeClass('disabled');
            $('#id_document_number').removeAttr("readonly");
        }
        {% if status == 2 or status == 4 %} /* STATUS_TYPE_DICT['Posted'] or STATUS_TYPE_DICT['Reversed']*/
            $('input').attr('readonly', 'readonly');
            $("#id_payment_code").attr("disabled", "disabled");
            $("#id_account_set").attr("disabled", "disabled");
            $("#id_transaction_type").attr("disabled", "disabled");
        {% endif %}
        $('#search_entry_table_filter label input').removeAttr('readonly');

        //$('#id_transaction_type').focus();
        $('#id_description').focus();

        check_if_empty('#btnSave');
        
        update_final_exch_rate();
    });


    function dateView(date){
        var pecahin = date.split('-');
        var today = pecahin[2]+'-'+pecahin[1]+'-'+pecahin[0];
        return today
    }
    function takeday(date) {
        var pecahin = date.split('-');
        var today = pecahin[2]+'-'+pecahin[1]+'-'+pecahin[0];
        return today
    }

    var ref = $('#id_reference').val();
    var serial_no = '';

    $('#id_serial_no').on('change', function(e){
        var intRegex = /[0-9]+$/;
        if($(this).val().match(intRegex)){
            serial_no = $(this).val();
            var day = $('#doc_date_view').val();
            var pecahin = day.split('-');
            var bulan = pecahin[1];
            var tahun = pecahin[2].substring(2, 4);
            var bank_id = $("#id_bank option:selected").val();
            var curr_val = $("#id_currency").val();
            var curr = $("#id_currency option[value="+curr_val+"]").text();
            if ((ref == '') & (bank_id > 0) & (serial_no != '')) {
                bank = $("#id_bank option:selected").text().substring(0, 3);
                $('#id_reference').val(bank + '-R' + serial_no + '-' + bulan + '/' + tahun + '' + curr);
            }
        } else {
            pop_ok_dialog("Invalid Serial number",
                "Serial number should be an integer",
                function () { $('#id_serial_no').val(''); })
        }
    });
    $("#id_customer").on('change', function () {
        var day = $('#doc_date_view').val();
        var pecahin = day.split('-');
        var bulan = pecahin[1];
        var tahun = pecahin[2].substring(2, 4);
        var bank_id = $("#id_bank option:selected").val();
        var serial = serial_no;
        var curr_val = $("#id_currency").val();
        var curr = $("#id_currency option[value=" + curr_val + "]").text();
        if ((ref == '') & (bank_id > 0) & (serial_no != '')){
            bank = $("#id_bank option:selected").text().substring(0, 3);
            // id_ven = $("#id_supplier option:selected").val();
            $('#id_reference').val(bank+'-R'+serial+'-'+bulan+'/'+tahun+''+curr);
        }
        transaction_new.length = 0;
    });

    $('#id_bank').on('select2:close', function (e)
    {
        $('#id_name').focus();
    });
    $('#id_transaction_type').on('select2:close', function (e)
    {
        $('#doc_date_view').focus();
    });
    $('#id_customer').on('select2:close', function (e)
    {
        $('#id_payment_code').select2('open');
        $('#id_payment_code').focus();
    });
    $('#id_account_set').on('select2:close', function (e)
    {
        $('#id_payment_code').select2('open');
        $('#id_payment_code').focus();
    });
    $('#id_account_set').on('change', function (e)
    {
        $('#id_payment_code').select2('open');
        $('#id_payment_code').focus();
    });
    $('#id_payment_code').on('select2:close', function (e)
    {
        $('#id_payment_check_number').focus();
    });
    </script>
    <script type="text/javascript" src="{% static 'js/standard.js' %}"></script>
    <script type="application/javascript" src="{% static 'js/accounting/AR_Receipt_Entry.js' %}"></script>
{% endblock %}
